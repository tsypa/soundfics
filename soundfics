#!/bin/sh

usage() {
    echo "usage $(basename $0) <status|start|stop|restart>"
}

isRunning() {
    if [ -f ${1} ] ; then
        PID=$(<${1})
        if ps -p ${PID} > /dev/null  ; then
            echo ${PID}
        fi
    fi
}

if [ ${#} -ne 1 ] ; then
    usage
    exit 1
fi

ACTION=${1}
PIDFILE='soundfics.pid'
PID=$(isRunning ${PIDFILE});

case ${ACTION} in
    "start")
        if [ ! -z  ${PID} ] ; then
            echo "already running, stop first"
            exit 1
        fi
        # if symlink then go to workdir
        if [ -L ${0} ] ; then
            cd $(dirname $(readlink -en ${0}))
        fi
        rm -f ${PIDFILE}
        npm start > /dev/null
        ;;
    "stop")
        if [ -z ${PID} ]; then
            echo 'not running'
        else
            kill ${PID}
        fi
        ;;
    "status")
        if [ -z ${PID} ]; then
            echo 'NOT RUNNING'
        else
            echo "RUNNING"
        fi
        ;;
    "restart")
        ${0} stop
        ${0} start
        ;;
    *)
        usage
        ;;
esac
